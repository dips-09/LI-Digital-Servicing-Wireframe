<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LI Digital Self-Service Portal (Static Demo)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind via CDN (no build required) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React, ReactDOM, Babel (for JSX in browser) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    </style>
  </head>

  <body class="bg-gray-50">
    <div id="root"></div>

    <!-- APP CODE -->
    <script type="text/babel" data-presets="react">
      const { useState, useEffect } = React;

      /****************************
       * SHARED MOCK DATA
       ****************************/
      const POLICIES = [
        {
          id: "POL-8945612",
          name: "XYZ Life Savings",
          type: "Endowment Plan",
          status: "Active",
          sumAssured: "‚Çπ10,00,000",
          premium: "‚Çπ12,450/year",
          nextDue: "15 Jan 2025",
          hasLoan: true,
          loanAmount: "‚Çπ1,25,000",
        },
        {
          id: "POL-7823451",
          name: "XYZ Tech Term",
          type: "Term Insurance",
          status: "Active",
          sumAssured: "‚Çπ50,00,000",
          premium: "‚Çπ8,900/year",
          nextDue: "22 Feb 2025",
          hasLoan: false,
          loanAmount: null,
        },
      ];

      /****************************
       * HEADER
       ****************************/
      function Header() {
        return (
          <header className="bg-gradient-to-r from-blue-900 to-blue-700 text-white shadow-lg">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex items-center justify-between h-20">
                {/* Logo */}
                <div className="flex items-center space-x-3">
                  <div className="flex items-center space-x-3">
                    <div className="h-10 w-10 rounded-lg bg-yellow-400 flex items-center justify-center text-blue-900 font-bold">
                      XYZ
                    </div>
                    <div>
                      <div className="text-yellow-400 tracking-wider text-sm">
                        XYZ Life Insurance
                      </div>
                      <div className="text-xs text-blue-200">
                        Digital Self-Service Portal
                      </div>
                    </div>
                  </div>
                </div>

                {/* Right section */}
                <div className="flex items-center space-x-6">
                  <div className="hidden md:flex items-center space-x-2 bg-blue-800 px-4 py-2 rounded-lg">
                    <svg
                      className="h-4 w-4 text-green-400"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      strokeWidth="2"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <path d="M12 1L3 5v6c0 5.25 3.75 10.74 9 12 5.25-1.26 9-6.75 9-12V5l-9-4z"></path>
                    </svg>
                    <span className="text-sm">Secure Session</span>
                  </div>

                  <button className="relative p-2 hover:bg-blue-800 rounded-lg transition-colors" title="Notifications">
                    <span className="sr-only">Notifications</span>
                    <svg
                      className="h-5 w-5"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      strokeWidth="2"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
                      <path d="M13.73 21a2 2 0 01-3.46 0"></path>
                    </svg>
                    <span className="absolute top-1 right-1 h-2 w-2 bg-red-500 rounded-full"></span>
                  </button>

                  <div className="flex items-center space-x-3">
                    <div className="hidden md:block text-right">
                      <div className="text-sm">Rajesh Kumar</div>
                      <div className="text-xs text-blue-200">Customer ID: LI2024589</div>
                    </div>
                    <div className="h-10 w-10 bg-yellow-500 rounded-full flex items-center justify-center text-blue-900 font-semibold">
                      RK
                    </div>
                  </div>

                  <button className="p-2 hover:bg-blue-800 rounded-lg transition-colors" title="Logout">
                    <svg
                      className="h-5 w-5"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      strokeWidth="2"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"></path>
                      <polyline points="16 17 21 12 16 7"></polyline>
                      <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div className="bg-blue-950 border-t border-blue-800">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2">
                <div className="flex items-center justify-center space-x-2 text-xs text-blue-200">
                  <svg
                    className="h-3 w-3"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  >
                    <path d="M12 1L3 5v6c0 5.25 3.75 10.74 9 12 5.25-1.26 9-6.75 9-12V5l-9-4z"></path>
                  </svg>
                  <span>All transactions are secured with 256-bit SSL encryption</span>
                </div>
              </div>
            </div>
          </header>
        );
      }

      /****************************
       * PROGRESS BAR
       ****************************/
      function ProgressBar({ steps, currentStep }) {
        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="flex items-center justify-between">
              {steps.map((step, index) => {
                const stepNumber = index + 1;
                const isCompleted = stepNumber < currentStep;
                const isCurrent = stepNumber === currentStep;
                return (
                  <div key={step} className="flex items-center flex-1">
                    <div className="flex flex-col items-center flex-1">
                      <div
                        className={
                          "w-10 h-10 rounded-full flex items-center justify-center transition-all " +
                          (isCompleted
                            ? "bg-green-600 text-white"
                            : isCurrent
                            ? "bg-blue-600 text-white ring-4 ring-blue-100"
                            : "bg-gray-200 text-gray-600")
                        }
                      >
                        {isCompleted ? (
                          <svg
                            className="h-5 w-5"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            strokeWidth="2"
                            strokeLinecap="round"
                            strokeLinejoin="round"
                          >
                            <polyline points="20 6 9 17 4 12" />
                          </svg>
                        ) : (
                          <span>{stepNumber}</span>
                        )}
                      </div>
                      <span
                        className={
                          "mt-2 text-sm text-center " +
                          (isCurrent ? "text-blue-600" : "text-gray-600")
                        }
                      >
                        {step}
                      </span>
                    </div>
                    {index < steps.length - 1 && (
                      <div
                        className={
                          "h-1 flex-1 mx-4 -mt-6 transition-all " +
                          (isCompleted ? "bg-green-600" : "bg-gray-200")
                        }
                      ></div>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        );
      }

      /****************************
       * POLICY SUMMARY CARD
       ****************************/
      function PolicySummary({ onServiceSelect }) {
        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-gray-900">Your Active Policies</h2>
              <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                {POLICIES.length} Active
              </span>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {POLICIES.map((policy) => (
                <div
                  key={policy.id}
                  className="border border-gray-200 rounded-lg p-5 hover:shadow-md transition-shadow"
                >
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex items-start space-x-3">
                      <div className="bg-blue-100 p-2 rounded-lg">
                        <span className="text-blue-600 text-xl">üìÑ</span>
                      </div>
                      <div>
                        <h3 className="text-gray-900">{policy.name}</h3>
                        <p className="text-sm text-gray-500">{policy.type}</p>
                        <p className="text-xs text-gray-400 mt-1">
                          Policy No: {policy.id}
                        </p>
                      </div>
                    </div>
                    <span className="bg-green-50 text-green-700 px-2 py-1 rounded text-xs">
                      {policy.status}
                    </span>
                  </div>

                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Sum Assured</p>
                      <p className="text-gray-900">{policy.sumAssured}</p>
                    </div>
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Premium</p>
                      <p className="text-gray-900">{policy.premium}</p>
                    </div>
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Next Premium Due</p>
                      <p className="text-gray-900">{policy.nextDue}</p>
                    </div>
                    {policy.hasLoan && (
                      <div>
                        <p className="text-xs text-gray-500 mb-1">Outstanding Loan</p>
                        <p className="text-orange-600">{policy.loanAmount}</p>
                      </div>
                    )}
                  </div>

                  {policy.hasLoan && (
                    <div className="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
                      <div className="flex items-start space-x-2">
                        <span className="text-orange-600 mt-0.5">‚ö†Ô∏è</span>
                        <div>
                          <p className="text-sm text-orange-900">
                            Outstanding loan amount: {policy.loanAmount}
                          </p>
                          <button
                            onClick={() =>
                              onServiceSelect("loan-repayment", policy.id)
                            }
                            className="text-sm text-orange-700 hover:text-orange-900 underline mt-1"
                          >
                            Pay now
                          </button>
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="flex space-x-2">
                    <button className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors flex items-center justify-center space-x-2">
                      <span>üìä</span>
                      <span>View Details</span>
                    </button>
                    <button
                      onClick={() => onServiceSelect("nomination", policy.id)}
                      className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm transition-colors flex items-center justify-center space-x-2"
                    >
                      <span>Quick Actions</span>
                      <span>‚Ä∫</span>
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      }

      /****************************
       * SERVICE CARD
       ****************************/
      function ServiceCard({ service, onClick }) {
        return (
          <button
            onClick={onClick}
            className="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-lg hover:border-blue-300 transition-all text-left group"
          >
            <div className="flex items-start justify-between mb-4">
              <div className={service.color + " p-3 rounded-lg"}>
                <span className="text-xl">{service.icon}</span>
              </div>
              <span className="h-5 w-5 text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all">
                ‚Ä∫
              </span>
            </div>

            <h3 className="text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
              {service.title}
            </h3>
            <p className="text-sm text-gray-600">{service.description}</p>
          </button>
        );
      }

      /****************************
       * DASHBOARD
       ****************************/
      function Dashboard({ onServiceSelect }) {
        const services = [
          {
            id: "enach",
            title: "e-NACH Registration",
            description: "Set up automatic premium payments",
            icon: "üí≥",
            category: "Payment Related",
            color: "bg-blue-50 text-blue-600",
          },
          {
            id: "fund-switch",
            title: "Unit Linked fund switch",
            description: "Switch between investment funds",
            icon: "üìà",
            category: "Payment Related",
            color: "bg-green-50 text-green-600",
          },
          {
            id: "neft",
            title: "NEFT registration",
            description: "Register for direct bank transfers",
            icon: "üè¶",
            category: "Payment Related",
            color: "bg-purple-50 text-purple-600",
          },
          {
            id: "change-mode",
            title: "Change of Mode",
            description: "Modify premium payment frequency",
            icon: "üîÅ",
            category: "Payment Related",
            color: "bg-orange-50 text-orange-600",
          },
          {
            id: "address",
            title: "Aadhaar based change of address",
            description: "Update your contact address",
            icon: "üìç",
            category: "Policy Related",
            color: "bg-indigo-50 text-indigo-600",
          },
          {
            id: "pan",
            title: "PAN data registration",
            description: "Link your PAN card details",
            icon: "üßæ",
            category: "Policy Related",
            color: "bg-teal-50 text-teal-600",
          },
          {
            id: "nomination",
            title: "Change of Nomination & Assignment",
            description: "Update your policy beneficiaries",
            icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
            category: "Policy Related",
            color: "bg-pink-50 text-pink-600",
          },
          {
            id: "loan-repayment",
            title: "Loan payment and repayment",
            description: "Pay outstanding policy loans",
            icon: "üí∞",
            category: "Policy Related",
            color: "bg-yellow-50 text-yellow-600",
          },
        ];

        const paymentServices = services.filter(
          (s) => s.category === "Payment Related"
        );
        const policyServices = services.filter(
          (s) => s.category === "Policy Related"
        );

        return (
          <div className="min-h-screen bg-gray-50">
            <Header />

            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="mb-8">
                <h1 className="text-gray-900 mb-2 text-2xl">
                  Welcome, Rajesh Kumar
                </h1>
                <p className="text-gray-600">
                  Manage your policies and service requests
                </p>
              </div>

              <PolicySummary onServiceSelect={onServiceSelect} />

              <div className="mt-12">
                <div className="flex items-center mb-6">
                  <div className="h-1 w-12 bg-gradient-to-r from-blue-600 to-yellow-500 mr-4"></div>
                  <h2 className="text-gray-900 text-lg">Online Service Requests</h2>
                </div>

                <div className="mb-10">
                  <h3 className="text-gray-900 mb-4">
                    Payment Related Services
                  </h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {paymentServices.map((service) => (
                      <ServiceCard
                        key={service.id}
                        service={service}
                        onClick={() => onServiceSelect(service.id)}
                      />
                    ))}
                  </div>
                </div>

                <div>
                  <h3 className="text-gray-900 mb-4">
                    Policy Related Services
                  </h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {policyServices.map((service) => (
                      <ServiceCard
                        key={service.id}
                        service={service}
                        onClick={() => onServiceSelect(service.id)}
                      />
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      /****************************
       * LOAN FLOW
       ****************************/
      function LoanPolicySelection({ onSelect, initialPolicyId }) {
        const [selectedPolicy, setSelectedPolicy] = useState(initialPolicyId || "");

        const loanPolicies = POLICIES.filter((p) => p.hasLoan);

        function handleContinue() {
          const policy = loanPolicies.find((p) => p.id === selectedPolicy);
          if (!policy) return;
          const loanDetails = {
            policyId: policy.id,
            policyName: policy.name,
            principal: 100000,
            interest: 25000,
            total: 125000,
          };
          onSelect(loanDetails);
        }

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <h2 className="text-gray-900 mb-2">Step 1: Select Policy & Loan</h2>
              <p className="text-gray-600">
                Choose the policy for which you want to repay the outstanding loan.
              </p>
            </div>

            <div className="space-y-4 mb-6">
              {loanPolicies.map((policy) => (
                <button
                  key={policy.id}
                  onClick={() => setSelectedPolicy(policy.id)}
                  className={
                    "w-full border-2 rounded-xl p-5 text-left transition-all " +
                    (selectedPolicy === policy.id
                      ? "border-blue-600 bg-blue-50"
                      : "border-gray-200 hover:border-blue-300")
                  }
                >
                  <div className="flex items-start justify-between">
                    <div className="flex items-start space-x-4">
                      <div
                        className={
                          "p-3 rounded-lg " +
                          (selectedPolicy === policy.id
                            ? "bg-blue-100"
                            : "bg-gray-100")
                        }
                      >
                        <span
                          className={
                            "text-xl " +
                            (selectedPolicy === policy.id
                              ? "text-blue-600"
                              : "text-gray-600")
                          }
                        >
                          üí∞
                        </span>
                      </div>
                      <div className="space-y-1">
                        <h3 className="text-gray-900">{policy.name}</h3>
                        <p className="text-sm text-gray-600">{policy.type}</p>
                        <p className="text-xs text-gray-500">
                          Policy No: {policy.id}
                        </p>
                        <p className="text-sm text-orange-700 mt-2">
                          Outstanding Loan: {policy.loanAmount}
                        </p>
                      </div>
                    </div>
                    <div
                      className={
                        "w-6 h-6 rounded-full border-2 flex items-center justify-center " +
                        (selectedPolicy === policy.id
                          ? "border-blue-600 bg-blue-600"
                          : "border-gray-300")
                      }
                    >
                      {selectedPolicy === policy.id && (
                        <div className="w-3 h-3 bg-white rounded-full"></div>
                      )}
                    </div>
                  </div>
                </button>
              ))}
            </div>

            <div className="flex justify-end">
              <button
                onClick={handleContinue}
                disabled={!selectedPolicy}
                className={
                  "bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-8 py-3 rounded-lg flex items-center space-x-2 transition-colors"
                }
              >
                <span>Continue</span>
                <span>‚Ä∫</span>
              </button>
            </div>
          </div>
        );
      }

      function LoanAmountInput({ loanDetails, onSubmit, onBack }) {
        const [amount, setAmount] = useState(loanDetails.total);
        const [error, setError] = useState("");

        function handleContinue() {
          if (!amount || amount <= 0) {
            setError("Please enter a valid amount.");
            return;
          }
          if (amount > loanDetails.total) {
            setError("Amount cannot exceed outstanding loan amount.");
            return;
          }
          onSubmit(amount);
        }

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <h2 className="text-gray-900 mb-2">Step 2: Payment Amount</h2>
              <p className="text-gray-600">
                Review your loan details and enter the amount you want to pay.
              </p>
            </div>

            <div className="bg-gray-50 rounded-lg p-4 mb-6">
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <p className="text-gray-500">Policy Number</p>
                  <p className="text-gray-900">{loanDetails.policyId}</p>
                </div>
                <div>
                  <p className="text-gray-500">Policy Name</p>
                  <p className="text-gray-900">{loanDetails.policyName}</p>
                </div>
                <div>
                  <p className="text-gray-500">Principal Outstanding</p>
                  <p className="text-gray-900">
                    ‚Çπ{loanDetails.principal.toLocaleString("en-IN")}
                  </p>
                </div>
                <div>
                  <p className="text-gray-500">Interest Outstanding</p>
                  <p className="text-gray-900">
                    ‚Çπ{loanDetails.interest.toLocaleString("en-IN")}
                  </p>
                </div>
                <div className="col-span-2">
                  <p className="text-gray-500">Total Outstanding</p>
                  <p className="text-gray-900 text-lg font-medium">
                    ‚Çπ{loanDetails.total.toLocaleString("en-IN")}
                  </p>
                </div>
              </div>
            </div>

            <div className="mb-4">
              <label className="block text-sm text-gray-700 mb-2">
                Amount to Pay (‚Çπ)
              </label>
              <input
                type="number"
                value={amount}
                onChange={(e) => {
                  setAmount(Number(e.target.value));
                  setError("");
                }}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
              />
              {error && (
                <p className="text-red-600 text-sm mt-2">{error}</p>
              )}
            </div>

            <div className="flex space-x-4 mt-6">
              <button
                onClick={onBack}
                className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors"
              >
                Back
              </button>
              <button
                onClick={handleContinue}
                className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
              >
                Continue to Payment
              </button>
            </div>
          </div>
        );
      }

      function LoanPaymentGateway({ amount, onSubmit, onBack }) {
        const [method, setMethod] = useState("UPI");
        const [processing, setProcessing] = useState(false);

        function handlePay() {
          setProcessing(true);
          setTimeout(() => {
            setProcessing(false);
            onSubmit(method);
          }, 1000);
        }

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <h2 className="text-gray-900 mb-2">Step 3: Payment Gateway</h2>
              <p className="text-gray-600">
                Choose a payment method and complete your payment.
              </p>
            </div>

            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <p className="text-sm text-blue-900">
                You are about to pay{" "}
                <span className="font-semibold">
                  ‚Çπ{amount.toLocaleString("en-IN")}
                </span>{" "}
                towards your policy loan.
              </p>
            </div>

            <div className="space-y-4 mb-6">
              {["UPI", "Net Banking", "Debit Card"].map((m) => (
                <button
                  key={m}
                  onClick={() => setMethod(m)}
                  className={
                    "w-full border-2 rounded-xl p-4 text-left transition-all " +
                    (method === m
                      ? "border-blue-600 bg-blue-50"
                      : "border-gray-200 hover:border-blue-300")
                  }
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div
                        className={
                          "w-10 h-10 rounded-lg flex items-center justify-center " +
                          (method === m ? "bg-blue-100" : "bg-gray-100")
                        }
                      >
                        <span className="text-lg">
                          {m === "UPI"
                            ? "üì±"
                            : m === "Net Banking"
                            ? "üíª"
                            : "üí≥"}
                        </span>
                      </div>
                      <div>
                        <p className="text-gray-900">{m}</p>
                        <p className="text-xs text-gray-500">
                          {m === "UPI" &&
                            "Pay using UPI apps like BHIM, GPay, PhonePe"}
                          {m === "Net Banking" &&
                            "Pay directly from your bank account"}
                          {m === "Debit Card" &&
                            "Pay using any Visa/Mastercard debit card"}
                        </p>
                      </div>
                    </div>
                    <div
                      className={
                        "w-6 h-6 rounded-full border-2 flex items-center justify-center " +
                        (method === m
                          ? "border-blue-600 bg-blue-600"
                          : "border-gray-300")
                      }
                    >
                      {method === m && (
                        <div className="w-3 h-3 bg-white rounded-full"></div>
                      )}
                    </div>
                  </div>
                </button>
              ))}
            </div>

            <div className="flex space-x-4">
              <button
                onClick={onBack}
                className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors"
              >
                Back
              </button>
              <button
                onClick={handlePay}
                disabled={processing}
                className={
                  "flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-colors"
                }
              >
                {processing ? "Processing..." : "Pay Now"}
              </button>
            </div>
          </div>
        );
      }

      function LoanPaymentConfirmation({
        transactionId,
        amount,
        paymentMethod,
        policyId,
        onBackToDashboard,
      }) {
        const today = new Date().toLocaleDateString("en-IN", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });

        return (
          <div className="max-w-2xl mx-auto">
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
              <div className="flex justify-center mb-6">
                <div className="bg-green-100 p-6 rounded-full">
                  <span className="text-green-600 text-4xl">‚úÖ</span>
                </div>
              </div>

              <div className="text-center mb-8">
                <h1 className="text-green-600 mb-3 text-2xl">
                  Payment Successful!
                </h1>
                <p className="text-gray-600">
                  Your loan payment has been received and is being processed.
                </p>
              </div>

              <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
                <div className="text-center">
                  <p className="text-sm text-blue-600 mb-2">
                    Transaction Reference
                  </p>
                  <p className="text-2xl text-blue-900 tracking-wider mb-2">
                    {transactionId}
                  </p>
                  <p className="text-xs text-blue-700">
                    Please save this reference for future communication.
                  </p>
                </div>
              </div>

              <div className="space-y-3 mb-6">
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Payment Date</span>
                  <span className="text-gray-900">{today}</span>
                </div>
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Policy Number</span>
                  <span className="text-gray-900">{policyId}</span>
                </div>
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Payment Method</span>
                  <span className="text-gray-900">{paymentMethod}</span>
                </div>
                <div className="flex items-center justify-between py-2">
                  <span className="text-gray-600">Amount Paid</span>
                  <span className="text-gray-900 font-semibold">
                    ‚Çπ{amount.toLocaleString("en-IN")}
                  </span>
                </div>
              </div>

              <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                <button
                  onClick={onBackToDashboard}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
                >
                  Back to Dashboard
                </button>
                <button className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors">
                  Download Receipt
                </button>
              </div>
            </div>
          </div>
        );
      }

      function LoanRepaymentFlow({ onBack, initialPolicyId }) {
        const [currentStep, setCurrentStep] = useState(1);
        const [loanDetails, setLoanDetails] = useState(null);
        const [paymentAmount, setPaymentAmount] = useState(0);
        const [paymentMethod, setPaymentMethod] = useState("");
        const [transactionId, setTransactionId] = useState("");

        const steps = [
          "Select Policy & Loan",
          "Payment Amount",
          "Payment Gateway",
          "Confirmation",
        ];

        function handleLoanSelect(details) {
          setLoanDetails(details);
          setCurrentStep(2);
        }

        function handleAmountSubmit(amount) {
          setPaymentAmount(amount);
          setCurrentStep(3);
        }

        function handlePaymentSubmit(method) {
          setPaymentMethod(method);
          const txnId = "TXN" + Date.now().toString().slice(-10);
          setTransactionId(txnId);
          setCurrentStep(4);
        }

        return (
          <div className="min-h-screen bg-gray-50">
            <Header />

            <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="mb-8">
                <button
                  onClick={onBack}
                  className="text-blue-600 hover:text-blue-700 mb-4 flex items-center space-x-2"
                >
                  <span>&larr;</span>
                  <span>Back to Dashboard</span>
                </button>

                <h1 className="text-gray-900 mb-2 text-2xl">
                  Loan Payment and Repayment
                </h1>
                <p className="text-gray-600">
                  Pay your outstanding policy loan securely.
                </p>
              </div>

              {currentStep < 4 && (
                <ProgressBar steps={steps} currentStep={currentStep} />
              )}

              <div className="mt-8">
                {currentStep === 1 && (
                  <LoanPolicySelection
                    onSelect={handleLoanSelect}
                    initialPolicyId={initialPolicyId}
                  />
                )}

                {currentStep === 2 && loanDetails && (
                  <LoanAmountInput
                    loanDetails={loanDetails}
                    onSubmit={handleAmountSubmit}
                    onBack={() => setCurrentStep(1)}
                  />
                )}

                {currentStep === 3 && loanDetails && (
                  <LoanPaymentGateway
                    amount={paymentAmount}
                    onSubmit={handlePaymentSubmit}
                    onBack={() => setCurrentStep(2)}
                  />
                )}

                {currentStep === 4 && loanDetails && (
                  <LoanPaymentConfirmation
                    transactionId={transactionId}
                    amount={paymentAmount}
                    paymentMethod={paymentMethod}
                    policyId={loanDetails.policyId}
                    onBackToDashboard={onBack}
                  />
                )}
              </div>
            </div>
          </div>
        );
      }

      /****************************
       * NOMINATION FLOW
       ****************************/
      function NominationPolicySelection({ onSelect, initialPolicyId }) {
        const [selectedPolicy, setSelectedPolicy] = useState(initialPolicyId || "");

        function handleContinue() {
          if (selectedPolicy) {
            onSelect(selectedPolicy);
          }
        }

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <h2 className="text-gray-900 mb-2">Step 1: Select Policy</h2>
              <p className="text-gray-600">
                Choose the policy for which you want to change the nomination.
              </p>
            </div>

            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <p className="text-sm text-blue-900">
                You can update your nomination details for any active policy. This change
                will be effective after verification and processing (3‚Äì5 business days).
              </p>
            </div>

            <div className="space-y-4 mb-6">
              {POLICIES.map((policy) => (
                <button
                  key={policy.id}
                  onClick={() => setSelectedPolicy(policy.id)}
                  className={
                    "w-full border-2 rounded-xl p-5 text-left transition-all " +
                    (selectedPolicy === policy.id
                      ? "border-blue-600 bg-blue-50"
                      : "border-gray-200 hover:border-blue-300")
                  }
                >
                  <div className="flex items-start justify-between">
                    <div className="flex items-start space-x-4">
                      <div
                        className={
                          "p-3 rounded-lg " +
                          (selectedPolicy === policy.id
                            ? "bg-blue-100"
                            : "bg-gray-100")
                        }
                      >
                        <span
                          className={
                            "text-xl " +
                            (selectedPolicy === policy.id
                              ? "text-blue-600"
                              : "text-gray-600")
                          }
                        >
                          üìÑ
                        </span>
                      </div>
                      <div className="flex-1">
                        <h3 className="text-gray-900 mb-1">{policy.name}</h3>
                        <p className="text-sm text-gray-600 mb-3">{policy.type}</p>

                        <div className="grid grid-cols-2 gap-4 mb-3 text-sm">
                          <div>
                            <p className="text-xs text-gray-500">Policy Number</p>
                            <p className="text-gray-900">{policy.id}</p>
                          </div>
                          <div>
                            <p className="text-xs text-gray-500">Sum Assured</p>
                            <p className="text-gray-900">{policy.sumAssured}</p>
                          </div>
                        </div>

                        <div className="bg-gray-50 rounded-lg p-3 text-xs text-gray-700">
                          Current nominee will be replaced by new nominee(s) after approval.
                        </div>
                      </div>
                    </div>
                    <div
                      className={
                        "w-6 h-6 rounded-full border-2 flex items-center justify-center " +
                        (selectedPolicy === policy.id
                          ? "border-blue-600 bg-blue-600"
                          : "border-gray-300")
                      }
                    >
                      {selectedPolicy === policy.id && (
                        <div className="w-3 h-3 bg-white rounded-full"></div>
                      )}
                    </div>
                  </div>
                </button>
              ))}
            </div>

            <div className="flex justify-end">
              <button
                onClick={handleContinue}
                disabled={!selectedPolicy}
                className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-8 py-3 rounded-lg flex items-center space-x-2 transition-colors"
              >
                <span>Continue</span>
                <span>‚Ä∫</span>
              </button>
            </div>
          </div>
        );
      }

      function NominationAuthentication({ onComplete, onBack }) {
        const [otpMethod, setOtpMethod] = useState("mobile");
        const [otp, setOtp] = useState(["", "", "", "", "", ""]);
        const [isOtpSent, setIsOtpSent] = useState(false);
        const [countdown, setCountdown] = useState(0);
        const [error, setError] = useState("");

        useEffect(() => {
          if (countdown > 0) {
            const timer = setTimeout(() => setCountdown((c) => c - 1), 1000);
            return () => clearTimeout(timer);
          }
        }, [countdown]);

        function handleSendOtp() {
          setIsOtpSent(true);
          setCountdown(30);
          setError("");
        }

        function handleOtpChange(index, value) {
          if (value.length > 1) return;
          const newOtp = [...otp];
          newOtp[index] = value;
          setOtp(newOtp);
          setError("");
        }

        function handleVerify() {
          const value = otp.join("");
          if (value.length !== 6) {
            setError("Please enter complete OTP.");
            return;
          }
          if (value === "123456") {
            onComplete();
          } else {
            setError("Invalid OTP. For demo, use 123456.");
          }
        }

        const maskedMobile = "+91 ******* 789";
        const maskedEmail = "ra****@email.com";

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <div className="flex items-center space-x-3 mb-3">
                <div className="bg-green-100 p-2 rounded-lg">
                  <span className="text-green-600 text-xl">üõ°Ô∏è</span>
                </div>
                <h2 className="text-gray-900">Step 2: Secure Authentication</h2>
              </div>
              <p className="text-gray-600">
                Verify your identity to proceed with nomination changes.
              </p>
            </div>

            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 text-sm text-yellow-900 flex space-x-3">
              <span className="mt-0.5">üîí</span>
              <p>
                For your security, we need to verify your identity before making changes
                to sensitive policy information.
              </p>
            </div>

            {!isOtpSent ? (
              <div className="space-y-4 mb-6">
                <p className="text-gray-900">Select OTP delivery method:</p>

                <button
                  onClick={() => setOtpMethod("mobile")}
                  className={
                    "w-full border-2 rounded-xl p-5 text-left transition-all " +
                    (otpMethod === "mobile"
                      ? "border-blue-600 bg-blue-50"
                      : "border-gray-200 hover:border-blue-300")
                  }
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-4">
                      <div
                        className={
                          "p-3 rounded-lg " +
                          (otpMethod === "mobile" ? "bg-blue-100" : "bg-gray-100")
                        }
                      >
                        <span
                          className={
                            "text-lg " +
                            (otpMethod === "mobile"
                              ? "text-blue-600"
                              : "text-gray-600")
                          }
                        >
                          üì±
                        </span>
                      </div>
                      <div>
                        <p className="text-gray-900 mb-1">Mobile Number</p>
                        <p className="text-sm text-gray-600">{maskedMobile}</p>
                      </div>
                    </div>
                    <div
                      className={
                        "w-6 h-6 rounded-full border-2 flex items-center justify-center " +
                        (otpMethod === "mobile"
                          ? "border-blue-600 bg-blue-600"
                          : "border-gray-300")
                      }
                    >
                      {otpMethod === "mobile" && (
                        <div className="w-3 h-3 bg-white rounded-full"></div>
                      )}
                    </div>
                  </div>
                </button>

                <button
                  onClick={() => setOtpMethod("email")}
                  className={
                    "w-full border-2 rounded-xl p-5 text-left transition-all " +
                    (otpMethod === "email"
                      ? "border-blue-600 bg-blue-50"
                      : "border-gray-200 hover:border-blue-300")
                  }
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-4">
                      <div
                        className={
                          "p-3 rounded-lg " +
                          (otpMethod === "email" ? "bg-blue-100" : "bg-gray-100")
                        }
                      >
                        <span
                          className={
                            "text-lg " +
                            (otpMethod === "email"
                              ? "text-blue-600"
                              : "text-gray-600")
                          }
                        >
                          ‚úâÔ∏è
                        </span>
                      </div>
                      <div>
                        <p className="text-gray-900 mb-1">Email Address</p>
                        <p className="text-sm text-gray-600">{maskedEmail}</p>
                      </div>
                    </div>
                    <div
                      className={
                        "w-6 h-6 rounded-full border-2 flex items-center justify-center " +
                        (otpMethod === "email"
                          ? "border-blue-600 bg-blue-600"
                          : "border-gray-300")
                      }
                    >
                      {otpMethod === "email" && (
                        <div className="w-3 h-3 bg-white rounded-full"></div>
                      )}
                    </div>
                  </div>
                </button>
              </div>
            ) : (
              <div className="mb-6">
                <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 text-sm text-green-900">
                  OTP sent successfully to{" "}
                  {otpMethod === "mobile" ? maskedMobile : maskedEmail}. Demo OTP:{" "}
                  <span className="font-mono">123456</span>
                </div>

                <label className="block mb-3 text-gray-900">
                  Enter 6-digit OTP:
                </label>

                <div className="flex space-x-3 mb-4">
                  {otp.map((digit, index) => (
                    <input
                      key={index}
                      type="text"
                      maxLength="1"
                      value={digit}
                      onChange={(e) => handleOtpChange(index, e.target.value)}
                      className="w-12 h-12 text-center border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none text-xl"
                    />
                  ))}
                </div>

                {error && (
                  <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4 text-sm text-red-900 flex space-x-2">
                    <span>‚ö†Ô∏è</span>
                    <p>{error}</p>
                  </div>
                )}

                <button
                  onClick={handleSendOtp}
                  disabled={countdown > 0}
                  className="text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400 disabled:cursor-not-allowed"
                >
                  {countdown > 0
                    ? `Resend OTP in ${countdown}s`
                    : "Resend OTP"}
                </button>
              </div>
            )}

            <div className="flex space-x-4">
              <button
                onClick={onBack}
                className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors"
              >
                Back
              </button>
              {!isOtpSent ? (
                <button
                  onClick={handleSendOtp}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
                >
                  Send OTP
                </button>
              ) : (
                <button
                  onClick={handleVerify}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
                >
                  Verify &amp; Continue
                </button>
              )}
            </div>
          </div>
        );
      }

      function NominationDetails({ onSubmit, onBack, existingNominees }) {
        const [nominees, setNominees] = useState(
          existingNominees && existingNominees.length
            ? existingNominees
            : [
                {
                  name: "",
                  relationship: "",
                  dateOfBirth: "",
                  share: "",
                  address: "",
                  phone: "",
                },
              ]
        );
        const [errors, setErrors] = useState([]);

        const relationships = [
          "Spouse",
          "Son",
          "Daughter",
          "Father",
          "Mother",
          "Brother",
          "Sister",
          "Other",
        ];

        function handleAddNominee() {
          if (nominees.length < 3) {
            setNominees([
              ...nominees,
              {
                name: "",
                relationship: "",
                dateOfBirth: "",
                share: "",
                address: "",
                phone: "",
              },
            ]);
          }
        }

        function handleRemoveNominee(index) {
          if (nominees.length > 1) {
            setNominees(nominees.filter((_, i) => i !== index));
          }
        }

        function handleNomineeChange(index, field, value) {
          const updated = nominees.map((n, i) =>
            i === index ? { ...n, [field]: value } : n
          );
          setNominees(updated);
          setErrors([]);
        }

        function validateForm() {
          const newErrors = [];
          nominees.forEach((nominee, index) => {
            if (!nominee.name)
              newErrors.push(`Nominee ${index + 1}: Name is required`);
            if (!nominee.relationship)
              newErrors.push(
                `Nominee ${index + 1}: Relationship is required`
              );
            if (!nominee.dateOfBirth)
              newErrors.push(
                `Nominee ${index + 1}: Date of birth is required`
              );
            if (!nominee.share)
              newErrors.push(
                `Nominee ${index + 1}: Share percentage is required`
              );
            if (!nominee.address)
              newErrors.push(`Nominee ${index + 1}: Address is required`);
            if (!nominee.phone)
              newErrors.push(
                `Nominee ${index + 1}: Phone number is required`
              );
          });
          const totalShare = nominees.reduce(
            (sum, n) => sum + (parseFloat(n.share) || 0),
            0
          );
          if (totalShare !== 100) {
            newErrors.push("Total share percentage must equal 100%.");
          }
          setErrors(newErrors);
          return newErrors.length === 0;
        }

        function handleContinue() {
          if (validateForm()) {
            onSubmit(nominees);
          }
        }

        const totalShare = nominees.reduce(
          (sum, n) => sum + (parseFloat(n.share) || 0),
          0
        );

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="mb-6">
              <h2 className="text-gray-900 mb-2">Step 3: Nominee Details</h2>
              <p className="text-gray-600">
                Add or update nominee information for your policy.
              </p>
            </div>

            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-sm text-blue-900 flex space-x-3">
              <span>‚ÑπÔ∏è</span>
              <div>
                <p className="mb-2">
                  You can add up to 3 nominees. The total share percentage must equal
                  100%.
                </p>
                <p>All fields are mandatory for each nominee.</p>
              </div>
            </div>

            {errors.length > 0 && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div className="flex items-start space-x-3">
                  <span>‚ö†Ô∏è</span>
                  <div className="text-sm text-red-900">
                    <p className="mb-2">Please fix the following errors:</p>
                    <ul className="list-disc list-inside space-y-1">
                      {errors.map((err, i) => (
                        <li key={i}>{err}</li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            )}

            <div className="space-y-6 mb-6">
              {nominees.map((nominee, index) => (
                <div
                  key={index}
                  className="border-2 border-gray-200 rounded-xl p-6"
                >
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="text-gray-900">Nominee {index + 1}</h3>
                    {nominees.length > 1 && (
                      <button
                        onClick={() => handleRemoveNominee(index)}
                        className="text-red-600 hover:text-red-700 text-sm"
                      >
                        Remove
                      </button>
                    )}
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm text-gray-700 mb-2">
                        Full Name <span className="text-red-600">*</span>
                      </label>
                      <input
                        type="text"
                        value={nominee.name}
                        onChange={(e) =>
                          handleNomineeChange(index, "name", e.target.value)
                        }
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                        placeholder="Enter full name"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-700 mb-2">
                        Relationship <span className="text-red-600">*</span>
                      </label>
                      <select
                        value={nominee.relationship}
                        onChange={(e) =>
                          handleNomineeChange(
                            index,
                            "relationship",
                            e.target.value
                          )
                        }
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                      >
                        <option value="">Select relationship</option>
                        {relationships.map((rel) => (
                          <option key={rel} value={rel}>
                            {rel}
                          </option>
                        ))}
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-700 mb-2">
                        Date of Birth <span className="text-red-600">*</span>
                      </label>
                      <input
                        type="date"
                        value={nominee.dateOfBirth}
                        onChange={(e) =>
                          handleNomineeChange(
                            index,
                            "dateOfBirth",
                            e.target.value
                          )
                        }
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-700 mb-2">
                        Share Percentage <span className="text-red-600">*</span>
                      </label>
                      <div className="relative">
                        <input
                          type="number"
                          min="0"
                          max="100"
                          value={nominee.share}
                          onChange={(e) =>
                            handleNomineeChange(
                              index,
                              "share",
                              e.target.value
                            )
                          }
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                          placeholder="0"
                        />
                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500">
                          %
                        </span>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-700 mb-2">
                        Phone Number <span className="text-red-600">*</span>
                      </label>
                      <input
                        type="tel"
                        value={nominee.phone}
                        onChange={(e) =>
                          handleNomineeChange(
                            index,
                            "phone",
                            e.target.value
                          )
                        }
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                        placeholder="+91 XXXXX XXXXX"
                      />
                    </div>

                    <div className="md:col-span-2">
                      <label className="block text-sm text-gray-700 mb-2">
                        Address <span className="text-red-600">*</span>
                      </label>
                      <textarea
                        value={nominee.address}
                        onChange={(e) =>
                          handleNomineeChange(
                            index,
                            "address",
                            e.target.value
                          )
                        }
                        rows="3"
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                        placeholder="Enter complete address"
                      />
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {nominees.length < 3 && (
              <button
                onClick={handleAddNominee}
                className="w-full border-2 border-dashed border-gray-300 hover:border-blue-600 hover:bg-blue-50 rounded-xl p-4 mb-6 flex items-center justify-center space-x-2 text-gray-600 hover:text-blue-600 transition-all text-sm"
              >
                <span>‚ûï</span>
                <span>Add Another Nominee</span>
              </button>
            )}

            <div className="bg-gray-50 rounded-lg p-4 mb-6">
              <div className="flex items-center justify-between">
                <span className="text-gray-700">Total Share Percentage:</span>
                <span
                  className={
                    "text-xl " +
                    (totalShare === 100
                      ? "text-green-600"
                      : totalShare > 100
                      ? "text-red-600"
                      : "text-gray-900")
                  }
                >
                  {totalShare}%
                </span>
              </div>
              {totalShare !== 100 && (
                <p className="text-sm text-gray-600 mt-2">
                  {totalShare < 100
                    ? `Add ${100 - totalShare}% more to reach 100%.`
                    : `Reduce by ${totalShare - 100}% to reach 100%.`}
                </p>
              )}
            </div>

            <div className="flex space-x-4">
              <button
                onClick={onBack}
                className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors"
              >
                Back
              </button>
              <button
                onClick={handleContinue}
                className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
              >
                Continue to Review
              </button>
            </div>
          </div>
        );
      }

      function NominationReview({ policyId, nominees, onSubmit, onEdit }) {
        const [consent, setConsent] = useState(false);
        const [declaration, setDeclaration] = useState(false);

        const policy = POLICIES.find((p) => p.id === policyId);
        const canSubmit = consent && declaration;

        return (
          <div className="space-y-6">
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
              <div className="mb-6">
                <h2 className="text-gray-900 mb-2">Step 4: Review &amp; Submit</h2>
                <p className="text-gray-600">
                  Please review all details carefully before submitting.
                </p>
              </div>

              <div className="mb-6">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-gray-900">Policy Information</h3>
                  <button
                    onClick={() => onEdit(1)}
                    className="text-blue-600 hover:text-blue-700 text-sm"
                  >
                    Edit
                  </button>
                </div>
                <div className="bg-gray-50 rounded-lg p-4 grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <p className="text-gray-500 text-xs">Policy Number</p>
                    <p className="text-gray-900">{policyId}</p>
                  </div>
                  <div>
                    <p className="text-gray-500 text-xs">Policy Name</p>
                    <p className="text-gray-900">{policy?.name}</p>
                  </div>
                  <div>
                    <p className="text-gray-500 text-xs">Type</p>
                    <p className="text-gray-900">{policy?.type}</p>
                  </div>
                  <div>
                    <p className="text-gray-500 text-xs">Sum Assured</p>
                    <p className="text-gray-900">{policy?.sumAssured}</p>
                  </div>
                </div>
              </div>

              <div>
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-gray-900">Nominee Details</h3>
                  <button
                    onClick={() => onEdit(3)}
                    className="text-blue-600 hover:text-blue-700 text-sm"
                  >
                    Edit
                  </button>
                </div>
                <div className="space-y-4">
                  {nominees.map((n, i) => (
                    <div
                      key={i}
                      className="bg-gray-50 rounded-lg p-4 text-sm grid grid-cols-2 gap-3"
                    >
                      <div>
                        <p className="text-gray-500">Name</p>
                        <p className="text-gray-900">{n.name}</p>
                      </div>
                      <div>
                        <p className="text-gray-500">Relationship</p>
                        <p className="text-gray-900">{n.relationship}</p>
                      </div>
                      <div>
                        <p className="text-gray-500">Date of Birth</p>
                        <p className="text-gray-900">{n.dateOfBirth}</p>
                      </div>
                      <div>
                        <p className="text-gray-500">Share</p>
                        <p className="text-gray-900">{n.share}%</p>
                      </div>
                      <div>
                        <p className="text-gray-500">Phone</p>
                        <p className="text-gray-900">{n.phone}</p>
                      </div>
                      <div className="col-span-2">
                        <p className="text-gray-500">Address</p>
                        <p className="text-gray-900">{n.address}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
              <h3 className="text-gray-900 mb-4">Declaration &amp; Consent</h3>

              <div className="space-y-4 text-sm">
                <label className="flex items-start space-x-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={declaration}
                    onChange={(e) => setDeclaration(e.target.checked)}
                    className="mt-1 h-5 w-5 text-blue-600 border-gray-300 rounded"
                  />
                  <span className="text-gray-700">
                    I declare that all the information provided above is true and
                    correct to the best of my knowledge.
                  </span>
                </label>

                <label className="flex items-start space-x-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={consent}
                    onChange={(e) => setConsent(e.target.checked)}
                    className="mt-1 h-5 w-5 text-blue-600 border-gray-300 rounded"
                  />
                  <span className="text-gray-700">
                    I consent to XYZ verifying the details provided and processing this
                    nomination change request.
                  </span>
                </label>
              </div>

              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6 text-sm text-yellow-900 flex space-x-3">
                <span>‚ÑπÔ∏è</span>
                <div>
                  <p className="mb-2">Important Notes:</p>
                  <ul className="list-disc list-inside space-y-1">
                    <li>This change will be processed within 3‚Äì5 business days.</li>
                    <li>You will receive a confirmation via SMS and email.</li>
                    <li>Original documents may be required for verification.</li>
                  </ul>
                </div>
              </div>
            </div>

            <div className="flex space-x-4">
              <button
                onClick={() => onEdit(3)}
                className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors"
              >
                Back to Edit
              </button>
              <button
                onClick={onSubmit}
                disabled={!canSubmit}
                className={
                  "flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-colors"
                }
              >
                Submit Request
              </button>
            </div>
          </div>
        );
      }

      function NominationConfirmation({ referenceNumber, onBackToDashboard }) {
        const currentDate = new Date().toLocaleDateString("en-IN", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });
        const expectedCompletion = new Date(
          Date.now() + 5 * 24 * 60 * 60 * 1000
        ).toLocaleDateString("en-IN", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });

        return (
          <div className="max-w-2xl mx-auto">
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
              <div className="flex justify-center mb-6">
                <div className="bg-green-100 p-6 rounded-full">
                  <span className="text-green-600 text-4xl">‚úÖ</span>
                </div>
              </div>

              <div className="text-center mb-8">
                <h1 className="text-green-600 mb-3 text-2xl">
                  Request Submitted Successfully!
                </h1>
                <p className="text-gray-600">
                  Your nomination change request has been received and is being processed.
                </p>
              </div>

              <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6 text-center">
                <p className="text-sm text-blue-600 mb-2">Reference Number</p>
                <p className="text-3xl text-blue-900 tracking-wider mb-3">
                  {referenceNumber}
                </p>
                <p className="text-xs text-blue-700">
                  Please save this reference number for tracking your request.
                </p>
              </div>

              <div className="space-y-3 mb-6 text-sm">
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Submission Date</span>
                  <span className="text-gray-900">{currentDate}</span>
                </div>
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Request Type</span>
                  <span className="text-gray-900">Nomination Change</span>
                </div>
                <div className="flex items-center justify-between py-2 border-b border-gray-200">
                  <span className="text-gray-600">Status</span>
                  <span className="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs">
                    Under Review
                  </span>
                </div>
                <div className="flex items-center justify-between py-2">
                  <span className="text-gray-600">Expected Completion</span>
                  <span className="text-gray-900">{expectedCompletion}</span>
                </div>
              </div>

              <div className="bg-gray-50 rounded-lg p-6 mb-6 text-sm text-gray-700">
                <p className="mb-1 font-medium flex items-center space-x-2">
                  <span>üì©</span>
                  <span>Confirmation sent to:</span>
                </p>
                <p>Email: ra****@email.com</p>
                <p>Mobile: +91 ******* 789</p>
              </div>

              <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                <button
                  onClick={onBackToDashboard}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors"
                >
                  Back to Dashboard
                </button>
                <button className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors">
                  Download Receipt
                </button>
              </div>

              <div className="mt-6 text-center text-xs text-gray-600">
                Need help? Contact our customer support at{" "}
                <a href="tel:1800-11-4545" className="text-blue-600 hover:underline">
                  1800-11-4545
                </a>
              </div>
            </div>
          </div>
        );
      }

      function NominationFlow({ onBack, initialPolicyId }) {
        const [currentStep, setCurrentStep] = useState(1);
        const [selectedPolicy, setSelectedPolicy] = useState(initialPolicyId || "");
        const [nominees, setNominees] = useState([]);
        const [referenceNumber, setReferenceNumber] = useState("");

        const steps = [
          "Select Policy",
          "Authenticate",
          "Nominee Details",
          "Review & Submit",
          "Confirmation",
        ];

        function handlePolicySelect(policyId) {
          setSelectedPolicy(policyId);
          setCurrentStep(2);
        }

        function handleAuthComplete() {
          setCurrentStep(3);
        }

        function handleNomineesSubmit(data) {
          setNominees(data);
          setCurrentStep(4);
        }

        function handleReviewSubmit() {
          const ref = "NOM" + Date.now().toString().slice(-8);
          setReferenceNumber(ref);
          setCurrentStep(5);
        }

        function handleEdit(step) {
          setCurrentStep(step);
        }

        return (
          <div className="min-h-screen bg-gray-50">
            <Header />

            <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="mb-8">
                <button
                  onClick={onBack}
                  className="text-blue-600 hover:text-blue-700 mb-4 flex items-center space-x-2"
                >
                  <span>&larr;</span>
                  <span>Back to Dashboard</span>
                </button>

                <h1 className="text-gray-900 mb-2 text-2xl">
                  Change of Nomination &amp; Assignment
                </h1>
                <p className="text-gray-600">
                  Update your policy beneficiaries securely.
                </p>
              </div>

              {currentStep < 5 && (
                <ProgressBar steps={steps} currentStep={currentStep} />
              )}

              <div className="mt-8 space-y-6">
                {currentStep === 1 && (
                  <NominationPolicySelection
                    onSelect={handlePolicySelect}
                    initialPolicyId={selectedPolicy}
                  />
                )}

                {currentStep === 2 && (
                  <NominationAuthentication
                    onComplete={handleAuthComplete}
                    onBack={() => setCurrentStep(1)}
                  />
                )}

                {currentStep === 3 && (
                  <NominationDetails
                    onSubmit={handleNomineesSubmit}
                    onBack={() => setCurrentStep(2)}
                    existingNominees={nominees}
                  />
                )}

                {currentStep === 4 && (
                  <NominationReview
                    policyId={selectedPolicy}
                    nominees={nominees}
                    onSubmit={handleReviewSubmit}
                    onEdit={handleEdit}
                  />
                )}

                {currentStep === 5 && (
                  <NominationConfirmation
                    referenceNumber={referenceNumber}
                    onBackToDashboard={onBack}
                  />
                )}
              </div>
            </div>
          </div>
        );
      }

      /****************************
       * ROOT APP
       ****************************/
      function App() {
        const [currentScreen, setCurrentScreen] = useState("dashboard"); // 'dashboard' | 'nomination' | 'loan-repayment'
        const [selectedPolicyId, setSelectedPolicyId] = useState("");

        function handleServiceSelect(service, policyId) {
          if (service === "nomination") {
            setCurrentScreen("nomination");
            if (policyId) setSelectedPolicyId(policyId);
          } else if (service === "loan-repayment") {
            setCurrentScreen("loan-repayment");
            if (policyId) setSelectedPolicyId(policyId);
          } else {
            alert("This service is not wired in this demo yet.");
          }
        }

        function handleBackToDashboard() {
          setCurrentScreen("dashboard");
          setSelectedPolicyId("");
        }

        if (currentScreen === "nomination") {
          return (
            <NominationFlow
              onBack={handleBackToDashboard}
              initialPolicyId={selectedPolicyId}
            />
          );
        }

        if (currentScreen === "loan-repayment") {
          return (
            <LoanRepaymentFlow
              onBack={handleBackToDashboard}
              initialPolicyId={selectedPolicyId}
            />
          );
        }

        return <Dashboard onServiceSelect={handleServiceSelect} />;
      }

      /****************************
       * MOUNT APP
       ****************************/
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>